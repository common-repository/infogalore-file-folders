!function(e,i){e.media_frame=!1,e.files=[],e.selected_id=0,e.initFiles=function(){var t=i("#folder_file_ids").val();t&&(e.files=i.map(t.split(","),function(e){return parseInt(e)}))},e.refreshFilesList=function(){var e=[],t=0;i("#igf-adm-folder-files tr").each(function(){e.push(i(this).data("file-id")),t+=1}),i("#folder_file_ids").val(e.join(",")),0===t?i("#igf-adm-empty-folder-message").show():i("#igf-adm-empty-folder-message").hide()},e.openModal=function(t,a,d){t||(t=0),e.selected_id=t,a||(a="Add Files to Folder"),d||(d="Add Files"),!1===e.media_frame&&(e.media_frame=wp.media.frames.files_frame=wp.media({title:a,button:{text:d},multiple:"add",toolbar:"select"}).on("open",function(){var i=e.media_frame.state().get("selection");if(i&&i.set(),e.selected_id>0){var t=wp.media.attachment(e.selected_id);t.fetch(),i.add(t?[t]:[])}}).on("select",function(){var t=e.media_frame.state().get("selection").toJSON();i.each(t,function(i,t){t&&t.id&&e.addFile(t)})})),e.media_frame.open()},e.addFile=function(t){var a,d=!0;-1==i.inArray(t.id,e.files)?(a=i(i("#igf-adm-folder-file-template").val()),a.attr("data-file-id",t.id)):(d=!1,a=i('[data-file-id="'+t.id+'"]')),a.find(".igf-adm-icon img").attr("src",t.icon),a.find(".igf-adm-filename").html(t.filename),a.find(".igf-adm-filename").attr("href",t.url),a.find(".igf-adm-title").html(t.title),a.find(".igf-adm-size").html(t.filesizeHumanReadable);var f=i("#igf-adm-file-shortcode-template").val().replace(/"0"/,'"'+t.id+'"');a.find(".igf-adm-shortcode input").val(f).attr("size",f.length),d&&(i("#igf-adm-folder-files tbody").append(a),e.files.push(t.id),e.refreshFilesList())},e.removeFile=function(t){var a=i.inArray(t,e.files);-1!==a&&e.files.splice(a,1),i('[data-file-id="'+t+'"]').remove(),e.refreshFilesList()},i(function(){e.initFiles(),i("#igf-adm-add-folder-files").on("click",function(t){t.preventDefault(),e.openModal(0,i(this).data("modal-title"),i(this).data("modal-button-text"))}),i("#igf-adm-folder-files tbody").on("click","a.igf-adm-remove",function(t){if(t.preventDefault(),window.confirm(INFOGALORE_FOLDERS_MEDIA.confirmation_text)){var a=i(this).parents("tr:first"),d=a.data("file-id");e.removeFile(d)}}).on("click","a.igf-adm-edit",function(){var t=i(this).parents("tr:first"),a=t.data("file-id");e.openModal(a)}).sortable({handle:".igf-adm-icon img",stop:function(){e.refreshFilesList()}})})}(window.IG_FOLDERS_MEDIA=window.IG_FOLDERS_MEDIA||{},jQuery);